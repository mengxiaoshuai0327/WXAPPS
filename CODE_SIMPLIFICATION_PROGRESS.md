# 代码简化进度

## 已完成

### 1. 简化注册逻辑 ✅
- ✅ 移除了复杂的 member_id 生成逻辑（60多行代码简化为直接插入）
- ✅ 移除了重试机制和冲突检查逻辑
- ✅ 改为直接使用数据库自动生成的 `id`

### 2. 简化邀请码查找逻辑 ✅
- ✅ 改为优先使用数据库ID查找（纯数字）
- ✅ 保留兼容性：仍然支持旧的 member_id 和 instructor_id 格式查找
- ✅ 移除了复杂的重试机制

### 3. 简化优惠券发放逻辑 ✅
- ✅ 移除了 `generateDiscountCode()` 的调用
- ✅ 不再插入 `discount_code` 字段，直接使用数据库ID
- ✅ 更新了所有优惠券发放的地方（会员邀请、授课人邀请、渠道邀请）

### 4. 代码清理 ✅
- ✅ 移除了不必要的日志输出
- ✅ 简化了变量使用

## 待完成

### 1. 修改其他创建用户的地方
- [ ] `backend/routes/admin/channel-sales.js` - 创建渠道销售
- [ ] `backend/routes/admin/instructors.js` - 创建授课人

### 2. 更新前端代码
- [ ] 修改所有使用 `member_id` 的地方改为使用 `id`
- [ ] 修改所有使用 `instructor_id` 的地方改为使用 `id`
- [ ] 修改所有使用 `discount_code` 的地方改为使用 `id`

### 3. 数据库字段处理（可选）
- [ ] 考虑是否保留 `member_id`、`instructor_id`、`discount_code` 字段（向后兼容）
- [ ] 或者完全移除这些字段

## 注意事项

1. **向后兼容**：当前的修改保留了向后兼容性，仍然支持使用旧的 member_id 和 instructor_id 格式作为邀请码查找
2. **数据库ID**：现在注册后直接使用 `users.id`，不再生成 member_id
3. **邀请码格式**：建议使用纯数字ID作为邀请码，但系统仍然支持旧的格式

## 代码行数减少

- **注册逻辑**：从 ~100行 减少到 ~20行（减少约80%）
- **邀请码查找**：从 ~150行 减少到 ~50行（减少约67%）
- **优惠券发放**：每个发放点减少了 ~10行代码

## 下一步

1. 继续简化其他创建用户的地方
2. 更新前端代码使用ID
3. 测试所有功能确保正常工作

