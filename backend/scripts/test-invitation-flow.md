# 测试邀请码功能指南

## 方法一：使用小程序控制台快速切换

在小程序开发者工具的控制台中，复制并执行以下代码：

```javascript
// 清除用户登录状态，进入游客界面
const app = getApp();

// 清除本地存储
wx.removeStorageSync('userInfo');
wx.removeStorageSync('openid');
wx.removeStorageSync('token');

// 清除全局数据
app.globalData.userInfo = null;
app.globalData.openid = null;
app.globalData.isLoggedIn = false;

console.log('✓ 已清除登录状态');

// 跳转到首页
wx.switchTab({
  url: '/pages/index/index',
  success: () => {
    wx.showToast({
      title: '已切换到游客状态',
      icon: 'success'
    });
  }
});
```

## 方法二：手动操作

1. 在小程序首页，如果已登录，点击"退出登录"按钮
2. 确认退出后，会自动切换到游客首页

## 可用的测试邀请码

可用的会员ID（邀请码）：
- **孟小帅**: `M03152922` (用户ID: 4)
- **测试用户**: `M02727509` (用户ID: 5)
- **测试2**: `M842734571` (用户ID: 9)
- **测试3**: `M842734592` (用户ID: 10)
- **测试4**: `M844236983` (用户ID: 11)

## 测试步骤

1. **切换到游客状态**
   - 使用上面的控制台代码，或点击"退出登录"

2. **进入注册页面**
   - 在游客首页，点击"注册会员"按钮
   - 或者通过URL直接跳转：`/pages/register/register?invite_code=M03152922`

3. **填写注册信息**
   - 昵称：任意（如：测试用户）
   - 姓名：任意（如：张三）
   - 手机号：输入一个未注册的手机号
   - 验证码：点击"获取验证码"，输入收到的验证码
   - **邀请码**：输入 `M03152922`（或其他可用邀请码）

4. **提交注册**
   - 勾选用户协议和隐私条款
   - 点击"注册会员"按钮

5. **验证结果**
   - 检查后台"邀请管理"页面，应该能看到新的邀请记录
   - 检查邀请人（孟小帅）的折扣券列表，应该有一张100元折扣券（来源：invite_register）
   - 检查被邀请人的折扣券列表，应该**没有**折扣券（已移除）

6. **测试首次购买**
   - 使用新注册的账号登录
   - 购买课券（首次购买）
   - 检查邀请人是否收到500元折扣券
   - 检查被邀请人是否**没有**收到折扣券（已移除）

## 预期结果

### 注册时
- ✅ 创建邀请记录（`invitations`表）
- ✅ 给邀请人发放100元折扣券
- ❌ 不给被邀请人发放折扣券（已移除）

### 首次购买时
- ✅ 给邀请人发放500元折扣券
- ✅ 更新邀请记录状态为'purchased'
- ❌ 不给被邀请人发放折扣券（已移除）





























































