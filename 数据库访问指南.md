# 小程序数据库访问指南

## 数据库连接信息

根据 `backend/config/database.js` 配置，数据库连接信息如下：

- **主机**: `localhost` (或 `.env` 中的 `DB_HOST`)
- **端口**: `3306` (或 `.env` 中的 `DB_PORT`)
- **数据库名**: `xiaocx_db` (或 `.env` 中的 `DB_NAME`)
- **用户名**: `root` (或 `.env` 中的 `DB_USER`)
- **密码**: 需要查看 `.env` 文件中的 `DB_PASSWORD`

## 访问方法

### 方法 1: MySQL 命令行客户端（推荐）

#### 1.1 直接连接数据库
```bash
mysql -u root -p xiaocx_db
```
输入密码后即可进入 MySQL 命令行。

#### 1.2 连接后选择数据库
```bash
mysql -u root -p
```
进入后执行：
```sql
USE xiaocx_db;
SHOW TABLES;
```

#### 1.3 常用 SQL 命令
```sql
-- 查看所有表
SHOW TABLES;

-- 查看表结构
DESCRIBE table_name;
-- 或
SHOW CREATE TABLE table_name;

-- 查询数据
SELECT * FROM table_name LIMIT 10;

-- 查看数据库信息
SELECT DATABASE();
```

### 方法 2: 使用项目提供的测试脚本

```bash
cd backend
npm run test-db
```

这会测试数据库连接并显示配置信息。

### 方法 3: 图形化工具（推荐用于数据管理）

#### 3.1 MySQL Workbench（官方工具）
1. 下载安装：[MySQL Workbench](https://dev.mysql.com/downloads/workbench/)
2. 创建新连接：
   - Connection Name: `Xiaocx Local`
   - Hostname: `localhost`
   - Port: `3306`
   - Username: `root`
   - Password: 输入你的数据库密码
   - Default Schema: `xiaocx_db`

#### 3.2 TablePlus（macOS 推荐）
1. 下载安装：[TablePlus](https://tableplus.com/)
2. 创建新连接：
   - Type: `MySQL`
   - Name: `Xiaocx Local`
   - Host: `localhost`
   - Port: `3306`
   - User: `root`
   - Password: 输入你的数据库密码
   - Database: `xiaocx_db`

#### 3.3 DBeaver（免费开源）
1. 下载安装：[DBeaver](https://dbeaver.io/)
2. 创建新连接：
   - Database: `MySQL`
   - Server Host: `localhost`
   - Port: `3306`
   - Database: `xiaocx_db`
   - Username: `root`
   - Password: 输入你的数据库密码

#### 3.4 Sequel Pro（macOS，已停止更新但可用）
1. 下载安装：[Sequel Pro](https://www.sequelpro.com/)
2. 连接信息：
   - Host: `127.0.0.1`
   - Username: `root`
   - Password: 输入你的数据库密码
   - Database: `xiaocx_db`

### 方法 4: 通过后端代码访问

你可以创建一个简单的脚本来查询数据库：

```javascript
// backend/scripts/query-db.js
const pool = require('../config/database');

async function queryDatabase() {
  try {
    const [rows] = await pool.query('SHOW TABLES');
    console.log('数据库表列表:');
    rows.forEach(row => {
      console.log(`  - ${Object.values(row)[0]}`);
    });
    
    // 示例：查询用户表
    // const [users] = await pool.query('SELECT * FROM users LIMIT 5');
    // console.log('用户数据:', users);
    
  } catch (error) {
    console.error('查询失败:', error);
  } finally {
    process.exit(0);
  }
}

queryDatabase();
```

运行：
```bash
cd backend
node scripts/query-db.js
```

## 检查数据库配置

### 查看 .env 文件中的配置
```bash
cd backend
cat .env | grep DB_
```

### 如果 .env 文件不存在，创建它
```bash
cd backend
cat > .env << EOF
DB_HOST=localhost
DB_PORT=3306
DB_USER=root
DB_PASSWORD=your_password_here
DB_NAME=xiaocx_db
EOF
```

## 常见问题排查

### 1. MySQL 服务未启动
```bash
# 检查 MySQL 是否运行
brew services list | grep mysql

# 启动 MySQL
brew services start mysql

# 或检查进程
ps aux | grep mysql | grep -v grep
```

### 2. 找不到 mysql 命令
```bash
# 如果使用 Homebrew 安装
export PATH="/opt/homebrew/bin:$PATH"

# 或使用完整路径
/opt/homebrew/bin/mysql -u root -p
```

### 3. 连接被拒绝
- 确认 MySQL 服务已启动
- 检查端口 3306 是否被占用：`lsof -i :3306`
- 确认防火墙设置

### 4. 密码错误
- 检查 `.env` 文件中的 `DB_PASSWORD`
- 或使用 MySQL root 密码重置

## 快速访问命令

```bash
# 方法 1: 直接连接（需要输入密码）
mysql -u root -p xiaocx_db

# 方法 2: 使用环境变量（如果已配置）
cd backend
mysql -u $DB_USER -p$DB_PASSWORD -h $DB_HOST $DB_NAME

# 方法 3: 测试连接
cd backend && npm run test-db
```

## 数据库表结构

查看完整的数据库结构：
```bash
cd backend
mysql -u root -p xiaocx_db < database/schema.sql
```

或查看 schema 文件：
```bash
cat backend/database/schema.sql
```
