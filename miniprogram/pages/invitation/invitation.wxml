<!--pages/invitation/invitation.wxml-->
<view class="container">
  <view class="section">
    <view class="section-title">æˆ‘çš„é‚€è¯·ç </view>
    <view class="invite-code">
      <text class="code">{{inviteCode}}</text>
      <button class="copy-btn" bindtap="copyInviteCode">å¤åˆ¶</button>
    </view>
    
    <!-- äºŒç»´ç æ˜¾ç¤º -->
    <view class="qr-code-section" wx:if="{{qrCodeUrl}}">
      <view class="qr-title">é‚€è¯·äºŒç»´ç </view>
      <view class="qr-container">
        <image class="qr-image" src="{{qrCodeUrl}}" mode="aspectFit"></image>
      </view>
      <text class="qr-tip">å¾®ä¿¡æ‰«ä¸€æ‰«ï¼Œç«‹å³æ³¨å†Œ</text>
    </view>

    <!-- æ“ä½œæŒ‰é’® -->
    <view class="action-buttons">
      <button class="action-btn share-btn" open-type="share">
        <text class="btn-icon">ğŸ“¤</text>
        <text>åˆ†äº«é‚€è¯·</text>
      </button>
      <button class="action-btn poster-btn" bindtap="generatePoster">
        <text class="btn-icon">ğŸ¨</text>
        <text>ç”Ÿæˆæµ·æŠ¥</text>
      </button>
    </view>
  </view>

  <view class="section" wx:if="{{inviteStats}}">
    <view class="section-title">é‚€è¯·ç»Ÿè®¡</view>
    <view class="stats">
      <view class="stat-card stat-card-blue">
        <view class="stat-icon">ğŸ‘¥</view>
        <text class="stat-value">{{inviteStats.total || 0}}</text>
        <text class="stat-label">æ€»é‚€è¯·äººæ•°</text>
      </view>
      <view class="stat-card stat-card-green">
        <view class="stat-icon">âœ“</view>
        <text class="stat-value">{{inviteStats.registered || 0}}</text>
        <text class="stat-label">å·²æ³¨å†Œ</text>
      </view>
      <view class="stat-card stat-card-orange">
        <view class="stat-icon">ğŸ«</view>
        <text class="stat-value">{{inviteStats.purchased || 0}}</text>
        <text class="stat-label">å·²è´­åˆ¸</text>
      </view>
    </view>
  </view>

  <view class="section">
    <view class="section-title">é‚€è¯·å¥–åŠ±</view>
    <view class="reward-info">
      <text>â€¢ æ¯æˆåŠŸé‚€è¯·1ä½æœ‹å‹æ³¨å†Œä¼šå‘˜ï¼Œå³å¯è·å¾—1å¼ 100å…ƒä¼˜æƒ åˆ¸</text>
      <text>â€¢ æ¯ä½é‚€è¯·çš„æœ‹å‹é¦–æ¬¡è´­ä¹°è¯¾åˆ¸ï¼Œå³å¯è·å¾—1å¼ 500å…ƒä¼˜æƒ åˆ¸</text>
    </view>
    
    <!-- å·²è·å¾—çš„é‚€è¯·å¥–åŠ±ä¼˜æƒ åˆ¸ -->
    <view class="reward-summary" wx:if="{{inviteCoupons.length > 0}}">
      <view class="summary-title">ç´¯è®¡è·å¾—å¥–åŠ±ï¼šÂ¥{{totalReward}}</view>
      <view class="coupons-list">
        <view class="coupon-item" wx:for="{{inviteCoupons}}" wx:key="id">
          <view class="coupon-amount">Â¥{{item.amount}}</view>
          <view class="coupon-details">
            <view class="coupon-info-row">
              <text class="coupon-source">{{item.source === 'invite_register' ? 'æ³¨å†Œå¥–åŠ±' : 'è´­åˆ¸å¥–åŠ±'}}</text>
              <view class="coupon-status-tag {{item.status === 'used' ? 'status-used' : item.status === 'expired' ? 'status-expired' : 'status-unused'}}">
                {{item.status === 'used' ? 'å·²ä½¿ç”¨' : item.status === 'expired' ? 'å·²è¿‡æœŸ' : 'æœªä½¿ç”¨'}}
              </view>
            </view>
            <text class="coupon-date">{{item.created_at_formatted || item.created_at}}</text>
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- æµ·æŠ¥é¢„è§ˆå¼¹çª— -->
  <view class="poster-modal" wx:if="{{showPoster}}" bindtap="closePoster">
    <view class="poster-content" catchtap="stopPropagation">
      <view class="poster-header">
        <text class="poster-title">é‚€è¯·æµ·æŠ¥</text>
        <text class="poster-close" bindtap="closePoster">Ã—</text>
      </view>
      <image class="poster-preview" src="{{posterImage}}" mode="aspectFit"></image>
      <view class="poster-actions">
        <button class="poster-action-btn" bindtap="savePoster">ä¿å­˜åˆ°ç›¸å†Œ</button>
        <button class="poster-action-btn cancel-btn" bindtap="closePoster">å–æ¶ˆ</button>
      </view>
    </view>
  </view>
</view>

