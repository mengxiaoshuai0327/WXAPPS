<!--pages/user-detail/user-detail.wxml-->
<view class="container">
  <view class="user-header">
    <view class="user-avatar" bindtap="chooseAvatar">
      <image wx:if="{{userInfo.avatar_url}}" src="{{userInfo.avatar_url}}" mode="aspectFill"></image>
      <text wx:else class="avatar-text">{{userInfo.nickname ? userInfo.nickname[0] : 'U'}}</text>
      <view class="avatar-upload-hint">
        <text class="upload-icon">ğŸ“·</text>
        <text class="upload-text">ç‚¹å‡»ä¸Šä¼ </text>
      </view>
    </view>
    <view class="user-name">{{userInfo.nickname || 'æœªè®¾ç½®æ˜µç§°'}}</view>
  </view>

  <view class="info-section">
    <view class="info-item">
      <text class="info-label">æ˜µç§°</text>
      <input class="info-input" value="{{userInfo.nickname}}" placeholder="è¯·è¾“å…¥æ˜µç§°" bindinput="onNicknameInput" />
    </view>
    <view class="info-item">
      <text class="info-label">å§“å</text>
      <input class="info-input" value="{{userInfo.real_name}}" placeholder="è¯·è¾“å…¥å§“å" bindinput="onRealNameInput" />
    </view>
    <view class="info-item">
      <text class="info-label">{{userInfo.displayIdLabel || 'ä¼šå‘˜ID'}}</text>
      <text class="info-value">{{userInfo.displayIdValue || 'æœªè®¾ç½®'}}</text>
    </view>
    <view class="info-item">
      <text class="info-label">åŠ å…¥æ—¶é—´</text>
      <text class="info-value">{{userInfo.created_at_formatted || 'æœªè®¾ç½®'}}</text>
    </view>
    <view class="info-item">
      <text class="info-label">æ‰‹æœºå·</text>
      <input class="info-input" value="{{userInfo.phone}}" placeholder="è¯·è¾“å…¥æ‰‹æœºå·" bindinput="onPhoneInput" />
    </view>
  </view>

  <!-- ä¼šå‘˜è¯¦ç»†èµ„æ–™ -->
  <view class="section-title" bindtap="toggleMemberProfile">
    <text>ä¼šå‘˜è¯¦ç»†èµ„æ–™ï¼ˆé€‰å¡«ï¼‰</text>
    <text class="section-arrow">{{showMemberProfile ? 'â–¼' : 'â–¶'}}</text>
  </view>
  <view class="info-section" wx:if="{{showMemberProfile}}">
    <view class="info-item">
      <text class="info-label">èŒä½/è§’è‰²</text>
      <picker mode="selector" range="{{positionOptions}}" range-key="label" value="{{positionIndex}}" bindchange="onPositionChange">
        <view class="picker-view">
          <view class="picker-content">
            <text class="{{positionDisplayText ? 'picker-text' : 'picker-placeholder'}}">
              {{positionDisplayText || 'è¯·é€‰æ‹©èŒä½/è§’è‰²'}}
            </text>
          </view>
          <text class="picker-arrow">â€º</text>
        </view>
      </picker>
    </view>
    <view class="info-item" wx:if="{{memberProfile.position === 'OF'}}">
      <text class="info-label">èŒä½è¯´æ˜</text>
      <input class="info-input" value="{{memberProfile.position_other}}" placeholder="è¯·è¾“å…¥èŒä½è¯´æ˜" bindinput="onPositionOtherInput" />
    </view>
    <view class="info-item">
      <text class="info-label">å…¬å¸ç±»å‹</text>
      <picker mode="selector" range="{{companyTypeOptions}}" range-key="label" value="{{companyTypeIndex}}" bindchange="onCompanyTypeChange">
        <view class="picker-view">
          <view class="picker-content">
            <text class="{{companyTypeDisplayText ? 'picker-text' : 'picker-placeholder'}}">
              {{companyTypeDisplayText || 'è¯·é€‰æ‹©å…¬å¸ç±»å‹'}}
            </text>
          </view>
          <text class="picker-arrow">â€º</text>
        </view>
      </picker>
    </view>
    <view class="info-item" wx:if="{{memberProfile.company_type === 'OF' || memberProfile.company_type === 'OJ'}}">
      <text class="info-label">å…¬å¸ç±»å‹è¯´æ˜</text>
      <input class="info-input" value="{{memberProfile.company_type_other}}" placeholder="è¯·è¾“å…¥å…¬å¸ç±»å‹è¯´æ˜" bindinput="onCompanyTypeOtherInput" />
    </view>
    <view class="info-item">
      <text class="info-label">å²—ä½å¤´è¡”</text>
      <input class="info-input" value="{{memberProfile.job_title}}" placeholder="è¯·è¾“å…¥å²—ä½å¤´è¡”" bindinput="onJobTitleInput" />
    </view>
    <view class="info-item">
      <text class="info-label">åœ¨æœ¬å²—ä½ä»»èŒå¹´æ•°</text>
      <input class="info-input" type="digit" value="{{memberProfile.position_years}}" placeholder="è¯·è¾“å…¥ä»»èŒå¹´æ•°" bindinput="onPositionYearsInput" />
    </view>
    <view class="info-item">
      <text class="info-label">åœ¨ä¼ä¸šæ€»è®¡å·¥ä½œå¹´é™</text>
      <input class="info-input" type="digit" value="{{memberProfile.total_work_years}}" placeholder="è¯·è¾“å…¥å·¥ä½œå¹´é™" bindinput="onTotalWorkYearsInput" />
    </view>
    <view class="info-item">
      <text class="info-label">ç®¡ç†çš„è´¢åŠ¡å›¢é˜Ÿäººæ•°</text>
      <input class="info-input" type="number" value="{{memberProfile.managed_team_size}}" placeholder="è¯·è¾“å…¥äººæ•°" bindinput="onManagedTeamSizeInput" />
    </view>
    <view class="info-item">
      <text class="info-label">ä¼ä¸šæ•´ä¸ªè´¢åŠ¡å›¢é˜Ÿäººæ•°</text>
      <input class="info-input" type="number" value="{{memberProfile.total_finance_team_size}}" placeholder="è¯·è¾“å…¥äººæ•°" bindinput="onTotalFinanceTeamSizeInput" />
    </view>
    <view class="info-item">
      <text class="info-label">ç¦»è´¢åŠ¡ä¸€å·ä½æ±‡æŠ¥å…³ç³»å±‚æ•°</text>
      <input class="info-input" type="number" value="{{memberProfile.reporting_layers}}" placeholder="è¯·è¾“å…¥å±‚æ•°ï¼ˆè´¢åŠ¡ä¸€å·ä½å¡«0ï¼‰" bindinput="onReportingLayersInput" />
    </view>
  </view>

  <!-- èƒ½åŠ›è‡ªè¯„ -->
  <view class="section-title" bindtap="toggleAbilityAssessment">
    <text>èƒ½åŠ›è‡ªè¯„ï¼ˆé€‰å¡«ï¼‰</text>
    <text class="section-arrow">{{showAbilityAssessment ? 'â–¼' : 'â–¶'}}</text>
  </view>
  <view class="info-section" wx:if="{{showAbilityAssessment}}">
    <view class="info-item">
      <text class="info-label">è´¢åŠ¡ä¸“ä¸šèƒ½åŠ›</text>
      <picker mode="selector" range="{{financialAbilityOptions}}" range-key="label" value="{{financialAbilityIndex}}" bindchange="onFinancialAbilityChange">
        <view class="picker-view">
          <view class="picker-content">
            <text class="{{financialAbilityDisplayText ? 'picker-text' : 'picker-placeholder'}}">
              {{financialAbilityDisplayText || 'è¯·é€‰æ‹©'}}
            </text>
          </view>
          <text class="picker-arrow">â€º</text>
        </view>
      </picker>
    </view>
    <view class="info-item">
      <text class="info-label">ä¸šåŠ¡æ”¯æŒä¸ç»è¥ç®¡ç†èƒ½åŠ›</text>
      <view class="picker-view" bindtap="showBusinessAbilityPicker">
        <view class="picker-content">
          <text class="{{businessAbilityDisplayText ? 'picker-text' : 'picker-placeholder'}}">
            {{businessAbilityDisplayText || 'è¯·é€‰æ‹©'}}
          </text>
        </view>
        <text class="picker-arrow">â€º</text>
      </view>
    </view>
    <view class="info-item">
      <text class="info-label">æµç¨‹å’Œç³»ç»Ÿèƒ½åŠ›</text>
      <picker mode="selector" range="{{processAbilityOptions}}" range-key="label" value="{{processAbilityIndex}}" bindchange="onProcessAbilityChange">
        <view class="picker-view">
          <view class="picker-content">
            <text class="{{processAbilityDisplayText ? 'picker-text' : 'picker-placeholder'}}">
              {{processAbilityDisplayText || 'è¯·é€‰æ‹©'}}
            </text>
          </view>
          <text class="picker-arrow">â€º</text>
        </view>
      </picker>
    </view>
    <view class="info-item">
      <text class="info-label">é¢†å¯¼åŠ›å’Œå½±å“åŠ›</text>
      <picker mode="selector" range="{{leadershipAbilityOptions}}" range-key="label" value="{{leadershipAbilityIndex}}" bindchange="onLeadershipAbilityChange">
        <view class="picker-view">
          <view class="picker-content">
            <text class="{{leadershipAbilityDisplayText ? 'picker-text' : 'picker-placeholder'}}">
              {{leadershipAbilityDisplayText || 'è¯·é€‰æ‹©'}}
            </text>
          </view>
          <text class="picker-arrow">â€º</text>
        </view>
      </picker>
    </view>
    <view class="info-item">
      <text class="info-label">èµ„æœ¬è¿ä½œå’Œä»·å€¼ç®¡ç†èƒ½åŠ›</text>
      <picker mode="selector" range="{{capitalAbilityOptions}}" range-key="label" value="{{capitalAbilityIndex}}" bindchange="onCapitalAbilityChange">
        <view class="picker-view">
          <view class="picker-content">
            <text class="{{capitalAbilityDisplayText ? 'picker-text' : 'picker-placeholder'}}">
              {{capitalAbilityDisplayText || 'è¯·é€‰æ‹©'}}
            </text>
          </view>
          <text class="picker-arrow">â€º</text>
        </view>
      </picker>
    </view>
  </view>

  <!-- ä¸šåŠ¡èƒ½åŠ›å¤šé€‰å¼¹çª— -->
  <view class="picker-modal" wx:if="{{showBusinessAbilityModal}}" bindtap="hideBusinessAbilityPicker">
    <view class="picker-modal-content" catchtap="">
      <view class="picker-modal-header">
        <text class="picker-modal-title">ä¸šåŠ¡æ”¯æŒä¸ç»è¥ç®¡ç†èƒ½åŠ›</text>
        <text class="picker-modal-close" catchtap="hideBusinessAbilityPicker">å®Œæˆ</text>
      </view>
      <view class="picker-modal-body">
        <view class="modal-checkbox-item" wx:for="{{businessAbilityOptions}}" wx:key="value" catchtap="selectBusinessAbilityOption" data-value="{{item.value}}">
          <text class="modal-checkbox-label {{abilityAssessment.business_ability === item.value ? 'selected' : ''}}">{{item.label}}</text>
        </view>
      </view>
    </view>
  </view>

  <view class="action-section">
    <button class="btn-save" bindtap="saveUserInfo">ä¿å­˜ä¿®æ”¹</button>
  </view>
</view>
