<!--pages/theme-detail/theme-detail.wxml-->
<view class="container">
  <!-- é¡¶éƒ¨è£…é¥° -->
  <view class="top-decoration"></view>
  
  <view class="content-wrapper">
    <!-- ä¸»é¢˜ä¿¡æ¯å¡ç‰‡ -->
    <view class="theme-info-card">
      <view class="theme-header">
        <view class="theme-icon-wrapper" style="background-color: {{themeColor}};">
          <text class="theme-icon">{{themeIcon}}</text>
        </view>
        <view class="theme-title-wrapper">
          <view class="theme-title">{{themeFullName ? themeFullName : themeName}}</view>
          <view class="theme-module" wx:if="{{themeName}}">{{themeName}}</view>
        </view>
      </view>
      <view class="theme-description" wx:if="{{themeDescription}}">
        {{themeDescription}}
      </view>
    </view>

    <!-- æ’è¯¾åˆ—è¡¨ -->
    <view class="schedule-list">
      <view class="section-title">æ’è¯¾åˆ—è¡¨</view>
      <view wx:if="{{loading}}" class="loading">åŠ è½½ä¸­...</view>
      <view wx:else>
        <view wx:if="{{schedules.length > 0}}">
          <view class="schedule-item" wx:for="{{schedules}}" wx:key="id">
            <!-- ä¸»ä½“å†…å®¹ï¼šå·¦ä¾§å›¾ç‰‡ + å³ä¾§ä¿¡æ¯ -->
            <view class="card-body">
              <!-- å·¦ä¾§å›¾ç‰‡ï¼šæˆè¯¾æ•™å¸ˆå¤´åƒ -->
              <view class="course-image">
                <image 
                  class="instructor-avatar" 
                  src="{{item.instructor_avatar || '/images/å¤´åƒ.png'}}" 
                  mode="aspectFill"
                  lazy-load="true"
                ></image>
              </view>

              <!-- å³ä¾§å†…å®¹ -->
              <view class="course-content">
                <!-- è¯¾ç¨‹æ ‡é¢˜ -->
                <view class="course-title">{{item.title}}</view>

                <!-- è®²å¸ˆä¿¡æ¯ -->
                <view class="info-row">
                  <text class="info-icon">ğŸ‘¤</text>
                  <text class="info-text">{{item.instructor_name}}</text>
                </view>

                <!-- å¼€è¯¾æ—¶é—´ï¼ˆå¾…å¼€è¯¾ä¸æ˜¾ç¤ºï¼‰ -->
                <view class="info-row" wx:if="{{item.status !== 'draft' && item.date_time_text && item.date_time_text !== 'å¾…å¼€è¯¾'}}">
                  <text class="info-icon">ğŸ•</text>
                  <text class="info-text">å¼€è¯¾æ—¶é—´: {{item.date_time_text}}</text>
                </view>

                <!-- æŠ¥åäººæ•°ï¼ˆå¾…å¼€è¯¾ä¸æ˜¾ç¤ºï¼‰ -->
                <view class="info-row" wx:if="{{item.status !== 'draft'}}">
                  <text class="info-icon blue">ğŸ‘¥</text>
                  <text class="info-text blue">{{item.current_students}}/{{item.max_students}}äºº</text>
                </view>

                <!-- å¾…å¼€è¯¾çŠ¶æ€æ˜¾ç¤º -->
                <view class="info-row" wx:if="{{item.status === 'draft'}}">
                  <text class="info-icon">ğŸ“</text>
                  <text class="info-text">å¾…å¼€è¯¾</text>
                </view>
              </view>
            </view>

            <!-- åº•éƒ¨ï¼šä½ç½®å’ŒçŠ¶æ€ -->
            <view class="card-footer">
              <!-- åœ°å€ä¿¡æ¯å•ç‹¬ä¸€è¡Œ -->
              <view class="location-row">
                <!-- æ¸¸å®¢æ˜¾ç¤º"çº¿ä¸‹" -->
                <view class="location-info" wx:if="{{userRole === 'visitor'}}">
                  <text class="location-icon">ğŸ“</text>
                  <text class="location-text">çº¿ä¸‹</text>
                </view>
                <!-- ä¼šå‘˜/æ•™ç»ƒ/æ¸ é“é”€å”®æ˜¾ç¤ºçœŸå®åœ°å€ -->
                <view class="location-info" wx:elif="{{userRole === 'member' || userRole === 'instructor' || isChannelSales}}">
                  <text class="location-icon">ğŸ“</text>
                  <text class="location-text">{{item.location || 'çº¿ä¸‹Â·æ•™å®¤'}}</text>
                </view>
                <!-- å…¶ä»–æƒ…å†µï¼ˆå…œåº•ï¼‰ -->
                <view class="location-info" wx:else>
                  <text class="location-icon">ğŸ“</text>
                  <text class="location-text">çº¿ä¸‹</text>
                </view>
              </view>
              <!-- æ“ä½œæŒ‰é’®åŒºåŸŸ -->
              <view class="footer-actions">
                <text wx:if="{{item.status === 'draft'}}" class="status-badge draft">å¾…å¼€è¯¾</text>
                <text wx:elif="{{item.is_in_progress}}" class="status-badge in-progress">ä¸Šè¯¾ä¸­</text>
                <text wx:elif="{{item.is_past}}" class="status-badge">å·²ç»“æŸ</text>
                <text wx:elif="{{item.current_students >= item.max_students}}" class="status-badge">å·²æ»¡å‘˜</text>
                <button wx:elif="{{item.current_students < item.max_students}}" 
                        class="btn-action btn-book" 
                        bindtap="handleBook" 
                        data-id="{{item.id}}">
                  é¢„è®¢
                </button>
              </view>
            </view>
          </view>
        </view>
        <view wx:else class="empty-state">
          <text class="empty-text">æš‚æ— æ’è¯¾æ•°æ®</text>
        </view>
      </view>
    </view>
  </view>
</view>
