<!--pages/my-bookings/my-bookings.wxml-->
<view class="container">
  <view class="header">
    <view class="header-title">å·²é¢„è®¢è¯¾ç¨‹</view>
  </view>

  <view class="bookings-list" wx:if="{{bookings.length > 0}}">
    <view class="booking-card" wx:for="{{bookings}}" wx:key="id">
      <view class="card-header">
        <view class="theme-dot"></view>
        <text class="theme-name">{{item.theme_name || 'è¯¾ç¨‹'}}</text>
      </view>

      <view class="card-body" bindtap="viewCourseDetail" data-id="{{item.course_id}}">
        <view class="course-content">
          <view class="course-title">{{item.title}}</view>
          
          <view class="info-row">
            <text class="info-icon">ğŸ‘¤</text>
            <text class="info-text">{{item.instructor_name}}</text>
          </view>

          <view class="info-row">
            <text class="info-icon">ğŸ•</text>
            <text class="info-text">å¼€è¯¾æ—¶é—´: {{item.date_time_text}}</text>
          </view>

          <view class="info-row">
            <text class="info-icon blue">ğŸ‘¥</text>
            <text class="info-text blue">{{item.current_students}}/{{item.max_students}}äºº</text>
          </view>

          <view class="info-row" wx:if="{{item.ticket_code}}">
            <text class="info-icon">ğŸ«</text>
            <text class="info-text">è¯¾åˆ¸: {{item.ticket_code}}</text>
          </view>
        </view>
      </view>

      <view class="card-footer">
        <!-- åœ°å€ä¿¡æ¯å•ç‹¬ä¸€è¡Œ -->
        <view class="location-row">
          <!-- æ¸¸å®¢æ˜¾ç¤º"çº¿ä¸‹" -->
          <view class="location-info" wx:if="{{userRole === 'visitor'}}">
            <text class="location-icon">ğŸ“</text>
            <text class="location-text">çº¿ä¸‹</text>
          </view>
          <!-- ä¼šå‘˜/æ•™ç»ƒ/æ¸ é“é”€å”®æ˜¾ç¤ºçœŸå®åœ°å€ -->
          <view class="location-info" wx:elif="{{userRole === 'member' || userRole === 'instructor' || isChannelSales}}">
            <text class="location-icon">ğŸ“</text>
            <text class="location-text">{{item.location || 'çº¿ä¸‹Â·æ•™å®¤'}}</text>
          </view>
          <!-- å…¶ä»–æƒ…å†µï¼ˆå…œåº•ï¼‰ -->
          <view class="location-info" wx:else>
            <text class="location-icon">ğŸ“</text>
            <text class="location-text">çº¿ä¸‹</text>
          </view>
        </view>
        <view class="footer-actions">
          <text class="status-badge" wx:if="{{item.is_past}}">å·²ç»“æŸ</text>
          <button wx:if="{{!item.is_past && item.can_cancel}}" 
                  class="btn-action btn-cancel" 
                  catchtap="cancelBooking" 
                  data-id="{{item.booking_id}}">
            å–æ¶ˆé¢„è®¢
          </button>
          <button wx:if="{{!item.is_past && !item.can_cancel && item.has_booking}}" 
                  class="btn-action btn-cancel-disabled" 
                  catchtap="showCancelTip"
                  data-id="{{item.booking_id}}">
            å–æ¶ˆé¢„è®¢
          </button>
          <text class="btn-action detail-btn" bindtap="viewCourseDetail" data-id="{{item.course_id}}">è¯¦æƒ… ></text>
        </view>
      </view>
    </view>
  </view>

  <view wx:if="{{bookings.length === 0 && !loading}}" class="empty-state">
    <text>æ‚¨è¿˜æ²¡æœ‰é¢„è®¢ä»»ä½•è¯¾ç¨‹</text>
    <button class="btn-primary" bindtap="goToSchedule">å»é¢„è®¢è¯¾ç¨‹</button>
  </view>

  <view wx:if="{{loading}}" class="loading">åŠ è½½ä¸­...</view>
</view>

