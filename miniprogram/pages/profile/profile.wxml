<!--pages/profile/profile.wxml-->
<view class="container">
  <!-- é¡¶éƒ¨è£…é¥° -->
  <view class="top-decoration"></view>
  
  <view class="content-wrapper">
    <!-- æœªç™»å½•çŠ¶æ€ -->
    <block wx:if="{{!userInfo}}">
      <view class="empty-login-card">
        <view class="empty-login">
          <text class="empty-icon">ğŸ‘¤</text>
          <text class="empty-text">è¯·å…ˆç™»å½•</text>
          <text class="empty-subtitle">ç™»å½•åå³å¯æŸ¥çœ‹ä¸ªäººä¿¡æ¯å’Œè¯¾ç¨‹</text>
          <button class="login-btn" bindtap="goToLogin">å»ç™»å½•</button>
        </view>
      </view>
    </block>

    <!-- å·²ç™»å½•çŠ¶æ€ -->
    <block wx:else>
      <!-- ä¸ªäººä¸“åŒº -->
      <view class="user-card-section">
        <!-- ä¸ªäººä¿¡æ¯å¡ç‰‡ -->
        <view class="user-card" bindtap="goToUserDetail">
          <view class="user-avatar">
            <image wx:if="{{userInfo.avatar_url}}" src="{{userInfo.avatar_url}}" mode="aspectFill"></image>
            <image wx:else src="../../images/å¤´åƒ.png" mode="aspectFill"></image>
          </view>
          <view class="user-info">
            <view class="user-name">{{userInfo.nickname || 'æœªè®¾ç½®æ˜µç§°'}}</view>
            <view class="user-badges">
              <text wx:if="{{isInstructor}}" class="badge instructor">æ•™ç»ƒ</text>
              <text wx:elif="{{isChannel}}" class="badge channel">æ¸ é“æ–¹</text>
              <text wx:elif="{{isChannelSales && channelPartnerName}}" class="badge channel">{{channelPartnerName}}</text>
              <text wx:else class="badge member">ä¼šå‘˜</text>
              <text wx:if="{{inviteBadge}}" class="badge invite-badge">é‚€è¯·è¾¾äººÂ·{{inviteBadge}}</text>
            </view>
          </view>
          <view class="arrow">â€º</view>
        </view>
      </view>

      <!-- æ•™ç»ƒä¸“åŒº -->
      <view class="section-card" wx:if="{{isInstructor}}">
        <view class="section-title">æ•™ç»ƒä¸“åŒº</view>
        <view class="menu-item" bindtap="goToInstructorProfile">
          <text class="menu-icon">ğŸ‘¨â€ğŸ«</text>
          <text class="menu-text">è®²å¸ˆèµ„æ–™</text>
          <text class="arrow">â€º</text>
        </view>
        <view class="menu-item" bindtap="goToInstructorCourses">
          <text class="menu-icon">ğŸ“š</text>
          <text class="menu-text">æˆè¯¾åˆ—è¡¨</text>
          <text class="arrow">â€º</text>
        </view>
        <view class="menu-item" bindtap="goToInstructorEvaluations">
          <text class="menu-icon">â­</text>
          <text class="menu-text">è¯¾ç¨‹è¯„ä»·</text>
          <text class="arrow">â€º</text>
        </view>
        <view class="menu-item" bindtap="goToPromotion">
          <text class="menu-icon">ğŸ“¢</text>
          <text class="menu-text">æ¨å¹¿ä¸“åŒº</text>
          <text class="arrow">â€º</text>
        </view>
      </view>

      <!-- æ¸ é“é”€å”®ä¸“åŒº -->
      <view class="section-card" wx:if="{{isChannelSales}}">
        <view class="section-title">æ¨å¹¿ä¸“åŒº</view>
        <view class="menu-item" bindtap="goToPromotion">
          <text class="menu-icon">ğŸ“¢</text>
          <text class="menu-text">æ¨å¹¿ä¸“åŒº</text>
          <text class="arrow">â€º</text>
        </view>
      </view>

      <!-- è¯¾åˆ¸ä¸“åŒºï¼ˆæ¸ é“æ–¹ä¸æ˜¾ç¤ºï¼‰ -->
      <view class="section-card" wx:if="{{userInfo && !isChannel}}">
        <view class="section-title">è¯¾åˆ¸ä¸“åŒº</view>
        
        <!-- è¯¾åˆ¸å¡ç‰‡ -->
        <view class="ticket-card">
          <view class="ticket-stats">
            <view class="stat-item">
              <text class="stat-value">{{ticketStats.unused}}</text>
              <text class="stat-label">æœªä½¿ç”¨</text>
            </view>
            <view class="stat-item">
              <text class="stat-value">{{ticketStats.booked}}</text>
              <text class="stat-label">å·²é¢„è®¢</text>
            </view>
            <view class="stat-item">
              <text class="stat-value">{{ticketStats.used}}</text>
              <text class="stat-label">å·²ä½¿ç”¨</text>
            </view>
          </view>
        </view>

        <!-- è¯¾åˆ¸æ“ä½œæŒ‰é’® -->
        <view class="menu-list">
          <view class="menu-item" bindtap="goToTicketList">
            <text class="menu-icon">ğŸ«</text>
            <text class="menu-text">è¯¾åˆ¸è¯¦æƒ…</text>
            <text class="arrow">â€º</text>
          </view>
          <view class="menu-item" bindtap="goToPurchaseTicket">
            <text class="menu-icon">ğŸ’°</text>
            <text class="menu-text">è´­ä¹°è¯¾åˆ¸</text>
            <text class="arrow">â€º</text>
          </view>
          <view class="menu-item" bindtap="goToGiftTicket">
            <text class="menu-icon">ğŸ</text>
            <text class="menu-text">èµ äºˆè¯¾åˆ¸</text>
            <text class="arrow">â€º</text>
          </view>
          <view class="menu-item" bindtap="goToInvoice">
            <text class="menu-icon">ğŸ“„</text>
            <text class="menu-text">å¼€å‘ç¥¨</text>
            <text class="arrow">â€º</text>
          </view>
        </view>
      </view>

      <!-- é‚€è¯·ä¸“åŒºï¼ˆæ¸ é“æ–¹ä¸æ˜¾ç¤ºï¼‰ -->
      <view class="section-card" wx:if="{{userInfo && !isChannel}}">
        <view class="section-title">é‚€è¯·ä¸“åŒº</view>
        
        <!-- é‚€è¯·äºŒç»´ç å¡ç‰‡ -->
        <view class="invite-qr-card" wx:if="{{qrCodeUrl}}">
          <view class="qr-code-container">
            <image class="qr-code-image" src="{{qrCodeUrl}}" mode="aspectFit"></image>
            <text class="qr-code-tip">æ‰«ç æ³¨å†Œå³å¯è·å¾—ä¼˜æƒ åˆ¸</text>
          </view>
          <!-- æ“ä½œæŒ‰é’® -->
          <view class="action-buttons">
            <button class="action-btn save-btn" bindtap="saveQRCode">
              <text class="btn-icon">ğŸ’¾</text>
              <text>ä¿å­˜äºŒç»´ç </text>
            </button>
            <button class="action-btn share-btn" open-type="share">
              <text class="btn-icon">ğŸ“¤</text>
              <text>åˆ†äº«äºŒç»´ç </text>
            </button>
          </view>
        </view>
        
        <!-- é‚€è¯·ç»Ÿè®¡å¡ç‰‡ -->
        <view class="invite-stats-card" wx:if="{{inviteStats}}">
          <view class="ticket-stats">
            <view class="stat-item">
              <text class="stat-value">{{inviteStats.total || 0}}</text>
              <text class="stat-label">æ€»é‚€è¯·äººæ•°</text>
            </view>
            <view class="stat-item">
              <text class="stat-value">{{inviteStats.registered || 0}}</text>
              <text class="stat-label">å·²æ³¨å†Œ</text>
            </view>
            <view class="stat-item">
              <text class="stat-value">{{inviteStats.purchased || 0}}</text>
              <text class="stat-label">å·²è´­åˆ¸</text>
            </view>
          </view>
        </view>
      </view>

      <!-- ä¼˜æƒ åˆ¸ä¸“åŒºï¼ˆæ¸ é“æ–¹ä¸æ˜¾ç¤ºï¼‰ -->
      <view class="section-card" wx:if="{{userInfo && !isChannel}}">
        <view class="section-title">ä¼˜æƒ åˆ¸ä¸“åŒº</view>
        
        <!-- ä¼˜æƒ åˆ¸å¡ç‰‡ -->
        <view class="ticket-card">
          <view class="ticket-stats">
            <view class="stat-item">
              <text class="stat-value">{{couponStats.unused}}</text>
              <text class="stat-label">æœªä½¿ç”¨</text>
            </view>
            <view class="stat-item">
              <text class="stat-value">{{couponStats.used}}</text>
              <text class="stat-label">å·²ä½¿ç”¨</text>
            </view>
            <view class="stat-item">
              <text class="stat-value">{{couponStats.expired}}</text>
              <text class="stat-label">å·²è¿‡æœŸ</text>
            </view>
          </view>
        </view>

        <!-- ä¼˜æƒ åˆ¸æ“ä½œæŒ‰é’® -->
        <view class="menu-list">
          <view class="menu-item" bindtap="goToDiscountCoupons">
            <text class="menu-icon">ğŸŸï¸</text>
            <text class="menu-text">æˆ‘çš„ä¼˜æƒ åˆ¸</text>
            <text class="arrow">â€º</text>
          </view>
        </view>
      </view>

      <!-- è¯¾ç¨‹ä¸“åŒºï¼ˆæ¸ é“æ–¹ä¸æ˜¾ç¤ºï¼‰ -->
      <view class="section-card" wx:if="{{userInfo && !isChannel}}">
        <view class="section-title">è¯¾ç¨‹ä¸“åŒº</view>
        <view class="menu-list">
          <view class="menu-item" bindtap="goToBookedCourses">
            <text class="menu-icon">ğŸ“…</text>
            <text class="menu-text">å·²é¢„è®¢è¯¾ç¨‹</text>
            <text class="arrow">â€º</text>
          </view>
          <view class="menu-item" bindtap="goToCompletedCourses">
            <text class="menu-icon">âœ…</text>
            <text class="menu-text">å·²ä¸Šè¯¾ç¨‹</text>
            <text class="arrow">â€º</text>
          </view>
          <view class="menu-item" bindtap="goToEvaluation">
            <text class="menu-icon">ğŸ’¬</text>
            <text class="menu-text">è¯¾ç¨‹è¯„ä»·</text>
            <text class="arrow">â€º</text>
          </view>
        </view>
      </view>

      <!-- é€€å‡ºç™»å½•æŒ‰é’® -->
      <view class="logout-section">
        <button class="logout-btn" bindtap="handleLogout">
          <text class="logout-text">é€€å‡ºç™»å½•</text>
        </button>
      </view>
    </block>
  </view>
</view>
