# 邀请功能说明

## 功能概述

实现了完整的会员邀请功能，包括：
1. 邀请二维码生成
2. 邀请海报生成
3. 分享到微信功能
4. 扫码自动填写邀请码

## 实现的功能

### 1. 后端二维码生成API

**接口路径**: `GET /api/invitations/qrcode/:inviteCode`

**功能**: 生成包含小程序注册页面路径和邀请码参数的二维码图片

**二维码内容格式**: `pages/register/register?invite_code=XXX`

**使用示例**:
```javascript
// 在小程序中调用
const qrCodeUrl = `${baseUrl}/invitations/qrcode/${inviteCode}`;
```

### 2. 小程序邀请页面功能

#### 2.1 二维码显示
- 在邀请页面自动加载并显示邀请二维码
- 二维码内容包含注册页面路径和邀请码参数
- 用户可以通过微信扫一扫扫描二维码

#### 2.2 海报生成
- 点击"生成海报"按钮可以生成精美的邀请海报
- 海报包含：
  - 小程序标题和邀请文案
  - 邀请码
  - 二维码
  - 奖励说明
- 生成的海报可以保存到相册并分享

#### 2.3 分享功能
- 点击"分享邀请"按钮可以分享到微信好友或群聊
- 分享后，好友点击链接会跳转到注册页面，并自动填写邀请码
- 支持分享到朋友圈

### 3. 扫码跳转和自动填写

当用户扫描邀请二维码时：
1. 如果是在微信内扫描，会直接打开小程序
2. 跳转到注册页面 (`pages/register/register`)
3. 自动在邀请码输入框中填写邀请人的ID号
4. 用户可以直接完成注册流程

## 使用流程

### 邀请人操作：
1. 进入"我的" → "我的邀请"
2. 查看自己的邀请码和二维码
3. 选择以下方式邀请：
   - **分享二维码**：点击"分享邀请"按钮，分享给微信好友
   - **生成海报**：点击"生成海报"按钮，生成海报后保存到相册，再分享
   - **直接复制邀请码**：复制邀请码，手动发送给朋友

### 被邀请人操作：
1. 收到邀请链接/二维码后，点击或扫描
2. 自动打开小程序并跳转到注册页面
3. 邀请码已自动填写
4. 完成注册流程

## 技术实现

### 后端
- 使用 `qrcode` 库生成二维码
- 二维码内容为小程序路径格式：`pages/register/register?invite_code=XXX`

### 前端
- 使用 Canvas API 生成邀请海报
- 实现 `onShareAppMessage` 和 `onShareTimeline` 支持分享
- 注册页面通过 `onLoad(options)` 接收邀请码参数

## 注意事项

1. **二维码格式**：当前使用的是普通二维码，包含小程序路径。在微信内扫描会自动打开小程序。

2. **海报生成**：海报使用 Canvas 绘制，首次生成可能需要一些时间，请耐心等待。

3. **分享功能**：分享到微信好友和群聊会自动跳转到注册页面并填写邀请码；分享到朋友圈需要用户手动打开链接。

4. **邀请码格式**：
   - 会员使用 `member_id` 作为邀请码
   - 授课人使用 `instructor_id` 作为邀请码

## 测试建议

1. **二维码测试**：
   - 在小程序内查看邀请页面，确认二维码正常显示
   - 使用微信扫一扫扫描二维码，确认能跳转到注册页面
   - 确认注册页面的邀请码已自动填写

2. **海报测试**：
   - 点击"生成海报"按钮，确认海报正常生成
   - 确认海报包含所有必要信息（标题、邀请码、二维码、奖励说明）
   - 测试保存海报到相册功能

3. **分享测试**：
   - 点击"分享邀请"按钮，测试分享到微信好友
   - 确认分享链接点击后能正确跳转并填写邀请码
   - 测试分享到朋友圈功能

## 后续优化建议

1. **小程序码API**：如果需要支持在微信外扫描也能打开小程序，可以使用微信的小程序码API（需要后端集成微信API）

2. **海报模板**：可以设计多个海报模板供用户选择

3. **统计功能**：可以添加二维码扫描统计，追踪不同邀请方式的转化率

4. **自定义分享图**：可以为分享功能添加自定义的分享图片，提升分享效果

